<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VenueDTO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ticketmonster Coverage Report monolith Scenario 2</a> &gt; <a href="index.source.html" class="el_package">org.jboss.examples.ticketmonster.rest.dto</a> &gt; <span class="el_source">VenueDTO.java</span></div><h1>VenueDTO.java</h1><pre class="source lang-java linenums">package org.jboss.examples.ticketmonster.rest.dto;

import java.io.Serializable;

import org.jboss.examples.ticketmonster.model.SectionAllocation;
import org.jboss.examples.ticketmonster.model.Show;
import org.jboss.examples.ticketmonster.model.TicketPrice;
import org.jboss.examples.ticketmonster.model.Venue;

import javax.persistence.EntityManager;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import org.jboss.examples.ticketmonster.rest.dto.AddressDTO;
import org.jboss.examples.ticketmonster.rest.dto.NestedMediaItemDTO;

import java.util.List;
import java.util.Set;
import java.util.HashSet;

import org.jboss.examples.ticketmonster.rest.dto.NestedSectionDTO;
import org.jboss.examples.ticketmonster.model.Section;

import java.util.Iterator;

import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement
public class VenueDTO implements Serializable
{

   private Long id;
   private String name;
   private AddressDTO address;
   private NestedMediaItemDTO mediaItem;
   private String description;
<span class="nc" id="L39">   private Set&lt;NestedSectionDTO&gt; sections = new HashSet&lt;NestedSectionDTO&gt;();</span>
   private int capacity;

   public VenueDTO()
<span class="nc" id="L43">   {</span>
<span class="nc" id="L44">   }</span>

   public VenueDTO(final Venue entity)
<span class="nc" id="L47">   {</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">      if (entity != null)</span>
      {
<span class="nc" id="L50">         this.id = entity.getId();</span>
<span class="nc" id="L51">         this.name = entity.getName();</span>
<span class="nc" id="L52">         this.address = new AddressDTO(entity.getAddress());</span>
<span class="nc" id="L53">         this.mediaItem = new NestedMediaItemDTO(entity.getMediaItem());</span>
<span class="nc" id="L54">         this.description = entity.getDescription();</span>
<span class="nc" id="L55">         Iterator&lt;Section&gt; iterSections = entity.getSections().iterator();</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">         while (iterSections.hasNext())</span>
         {
<span class="nc" id="L58">            Section element = iterSections.next();</span>
<span class="nc" id="L59">            this.sections.add(new NestedSectionDTO(element));</span>
<span class="nc" id="L60">         }</span>
<span class="nc" id="L61">         this.capacity = entity.getCapacity();</span>
      }
<span class="nc" id="L63">   }</span>

   public Venue fromDTO(Venue entity, EntityManager em)
   {
<span class="nc bnc" id="L67" title="All 2 branches missed.">      if (entity == null)</span>
      {
<span class="nc" id="L69">         entity = new Venue();</span>
      }
<span class="nc" id="L71">      entity.setName(this.name);</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">      if (this.address != null)</span>
      {
<span class="nc" id="L74">         entity.setAddress(this.address.fromDTO(entity.getAddress(), em));</span>
      }
<span class="nc bnc" id="L76" title="All 2 branches missed.">      if (this.mediaItem != null)</span>
      {
<span class="nc" id="L78">         entity.setMediaItem(this.mediaItem.fromDTO(entity.getMediaItem(),</span>
               em));
      }
<span class="nc" id="L81">      entity.setDescription(this.description);</span>
<span class="nc" id="L82">      Iterator&lt;Section&gt; iterSections = entity.getSections().iterator();</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">      while (iterSections.hasNext())</span>
      {
<span class="nc" id="L85">         boolean found = false;</span>
<span class="nc" id="L86">         Section section = iterSections.next();</span>
<span class="nc" id="L87">         Iterator&lt;NestedSectionDTO&gt; iterDtoSections = this.getSections()</span>
<span class="nc" id="L88">               .iterator();</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">         while (iterDtoSections.hasNext())</span>
         {
<span class="nc" id="L91">            NestedSectionDTO dtoSection = iterDtoSections.next();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (dtoSection.getId().equals(section.getId()))</span>
            {
<span class="nc" id="L94">               found = true;</span>
<span class="nc" id="L95">               break;</span>
            }
<span class="nc" id="L97">         }</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">         if (found == false)</span>
         {
<span class="nc" id="L100">            iterSections.remove();</span>
<span class="nc" id="L101">            List&lt;SectionAllocation&gt; sectionAllocations = findSectionAllocationBySection(section, em);</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">	        for(SectionAllocation sectionAllocation: sectionAllocations)</span>
            {
<span class="nc" id="L104">               em.remove(sectionAllocation);</span>
<span class="nc" id="L105">            }</span>
<span class="nc" id="L106">            List&lt;TicketPrice&gt; ticketPrices = findTicketPricesBySection(section, em);</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">            for(TicketPrice ticketPrice: ticketPrices)</span>
            {
<span class="nc" id="L109">               Show show = ticketPrice.getShow();</span>
<span class="nc" id="L110">               show.getTicketPrices().remove(ticketPrice);</span>
<span class="nc" id="L111">               em.remove(ticketPrice);</span>
<span class="nc" id="L112">            }</span>
<span class="nc" id="L113">            em.remove(section);</span>
         }
<span class="nc" id="L115">      }</span>
<span class="nc" id="L116">      Iterator&lt;NestedSectionDTO&gt; iterDtoSections = this.getSections()</span>
<span class="nc" id="L117">            .iterator();</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">      while (iterDtoSections.hasNext())</span>
      {
<span class="nc" id="L120">         boolean found = false;</span>
<span class="nc" id="L121">         NestedSectionDTO dtoSection = iterDtoSections.next();</span>
<span class="nc" id="L122">         iterSections = entity.getSections().iterator();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">         while (iterSections.hasNext())</span>
         {
<span class="nc" id="L125">            Section section = iterSections.next();</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (dtoSection.getId().equals(section.getId()))</span>
            {
<span class="nc" id="L128">               found = true;</span>
<span class="nc" id="L129">               break;</span>
            }
<span class="nc" id="L131">         }</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">         if (found == false)</span>
         {
<span class="nc" id="L134">            Iterator&lt;Section&gt; resultIter = em</span>
<span class="nc" id="L135">                  .createQuery(&quot;SELECT DISTINCT s FROM Section s&quot;,</span>
<span class="nc" id="L136">                        Section.class).getResultList().iterator();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">            while (resultIter.hasNext())</span>
            {
<span class="nc" id="L139">               Section result = resultIter.next();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">               if (result.getId().equals(dtoSection.getId()))</span>
               {
<span class="nc" id="L142">                  entity.getSections().add(result);</span>
<span class="nc" id="L143">                  break;</span>
               }
<span class="nc" id="L145">            }</span>
         }
<span class="nc" id="L147">      }</span>
<span class="nc" id="L148">      entity.setCapacity(this.capacity);</span>
<span class="nc" id="L149">      entity = em.merge(entity);</span>
<span class="nc" id="L150">      return entity;</span>
   }

   public List&lt;SectionAllocation&gt; findSectionAllocationBySection(Section section, EntityManager em)
   {
<span class="nc" id="L155">      CriteriaQuery&lt;SectionAllocation&gt; criteria = em</span>
<span class="nc" id="L156">             .getCriteriaBuilder().createQuery(SectionAllocation.class);</span>
<span class="nc" id="L157">      Root&lt;SectionAllocation&gt; from = criteria.from(SectionAllocation.class);</span>
<span class="nc" id="L158">      CriteriaBuilder builder = em.getCriteriaBuilder();</span>
<span class="nc" id="L159">      Predicate sectionIsSame = builder.equal(from.get(&quot;section&quot;), section);</span>
<span class="nc" id="L160">      return em.createQuery(</span>
<span class="nc" id="L161">             criteria.select(from).where(sectionIsSame)).getResultList();</span>
   }
   
   public List&lt;TicketPrice&gt; findTicketPricesBySection(Section section, EntityManager em)
   {
<span class="nc" id="L166">      CriteriaQuery&lt;TicketPrice&gt; criteria = em</span>
<span class="nc" id="L167">             .getCriteriaBuilder().createQuery(TicketPrice.class);</span>
<span class="nc" id="L168">      Root&lt;TicketPrice&gt; from = criteria.from(TicketPrice.class);</span>
<span class="nc" id="L169">      CriteriaBuilder builder = em.getCriteriaBuilder();</span>
<span class="nc" id="L170">      Predicate sectionIsSame = builder.equal(from.get(&quot;section&quot;), section);</span>
<span class="nc" id="L171">      return em.createQuery(</span>
<span class="nc" id="L172">             criteria.select(from).where(sectionIsSame)).getResultList();</span>
   }

   public Long getId()
   {
<span class="nc" id="L177">      return this.id;</span>
   }

   public void setId(final Long id)
   {
<span class="nc" id="L182">      this.id = id;</span>
<span class="nc" id="L183">   }</span>

   public String getName()
   {
<span class="nc" id="L187">      return this.name;</span>
   }

   public void setName(final String name)
   {
<span class="nc" id="L192">      this.name = name;</span>
<span class="nc" id="L193">   }</span>

   public AddressDTO getAddress()
   {
<span class="nc" id="L197">      return this.address;</span>
   }

   public void setAddress(final AddressDTO address)
   {
<span class="nc" id="L202">      this.address = address;</span>
<span class="nc" id="L203">   }</span>

   public NestedMediaItemDTO getMediaItem()
   {
<span class="nc" id="L207">      return this.mediaItem;</span>
   }

   public void setMediaItem(final NestedMediaItemDTO mediaItem)
   {
<span class="nc" id="L212">      this.mediaItem = mediaItem;</span>
<span class="nc" id="L213">   }</span>

   public String getDescription()
   {
<span class="nc" id="L217">      return this.description;</span>
   }

   public void setDescription(final String description)
   {
<span class="nc" id="L222">      this.description = description;</span>
<span class="nc" id="L223">   }</span>

   public Set&lt;NestedSectionDTO&gt; getSections()
   {
<span class="nc" id="L227">      return this.sections;</span>
   }

   public void setSections(final Set&lt;NestedSectionDTO&gt; sections)
   {
<span class="nc" id="L232">      this.sections = sections;</span>
<span class="nc" id="L233">   }</span>

   public int getCapacity()
   {
<span class="nc" id="L237">      return this.capacity;</span>
   }

   public void setCapacity(final int capacity)
   {
<span class="nc" id="L242">      this.capacity = capacity;</span>
<span class="nc" id="L243">   }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>